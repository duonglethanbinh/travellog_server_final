const express = require('express');
const bodyParser = require('body-parser');
const app = express();
const mongoose = require('mongoose');
const cors = require('cors');
require('dotenv/config');
const swaggerUi = require('swagger-ui-express');
const swaggerDocument = require('./swagger.json');


// Middleware
// parse application/x-www-form-urlencoded
app.use(bodyParser.urlencoded({extended: true}));
// parse application/json
app.use(bodyParser.json());
app.use(cors());

// Import Routes
const placesRoute = require('./routes/places');
const contactRoute = require('./routes/contacts');
const blogsRoute = require('./routes/blogs');
const usersRoute = require('./routes/users');

const options = {
  customCss: '.swagger-ui .topbar { display: none }',
  customSiteTitle: 'Travellog Server',
  // eslint-disable-next-line max-len
  customfavIcon: 'data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCAxMjYuOTM1IDEyNi45MzUiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDEyNi45MzUgMTI2LjkzNTsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI1MTJweCIgaGVpZ2h0PSI1MTJweCI+CjxnPgoJPGc+CgkJPHBhdGggc3R5bGU9ImZpbGw6I0ZGMUExQTsiIGQ9Ik0yMS41MjgsMTA0LjE3MmMwLDQuNTItMy42NjIsOC4xODEtOC4xODIsOC4xODFsMCwwYy00LjUxOSwwLTguMTgyLTMuNjYxLTguMTgyLTguMTgxVjgwLjQzNiAgICBjMC00LjUyLDMuNjYyLTguMTgzLDguMTgyLTguMTgzbDAsMGM0LjUxOSwwLDguMTgyLDMuNjYzLDguMTgyLDguMTgzVjEwNC4xNzJ6Ii8+Cgk8L2c+Cgk8Zz4KCQk8cGF0aCBzdHlsZT0iZmlsbDojRkY3Njc2OyIgZD0iTTEzLjM0Niw3Mi4yNTRjLTQuNTE5LDAtOC4xODIsMy42NjMtOC4xODIsOC4xODN2MS42MWMwLDQuNTE5LDMuNjYyLDguMTgxLDguMTgyLDguMTgxICAgIHM4LjE4Mi0zLjY2Miw4LjE4Mi04LjE4MXYtMS42MUMyMS41MjgsNzUuOTE3LDE3Ljg2Niw3Mi4yNTQsMTMuMzQ2LDcyLjI1NHoiLz4KCTwvZz4KCTxnPgoJCTxwYXRoIHN0eWxlPSJmaWxsOiMzMzM2M0E7IiBkPSJNMTMuMzQ2LDExMy44NTNjLTUuMzM5LDAtOS42ODItNC4zNDMtOS42ODItOS42ODFWODAuNDM3YzAtNS4zMzksNC4zNDMtOS42ODMsOS42ODItOS42ODMgICAgczkuNjgyLDQuMzQ0LDkuNjgyLDkuNjgzdjIzLjczNUMyMy4wMjgsMTA5LjUxLDE4LjY4NSwxMTMuODUzLDEzLjM0NiwxMTMuODUzeiBNMTMuMzQ2LDczLjc1NGMtMy42ODUsMC02LjY4MiwyLjk5OC02LjY4Miw2LjY4MyAgICB2MjMuNzM1YzAsMy42ODQsMi45OTcsNi42ODEsNi42ODIsNi42ODFzNi42ODItMi45OTcsNi42ODItNi42ODFWODAuNDM3QzIwLjAyOCw3Ni43NTIsMTcuMDMxLDczLjc1NCwxMy4zNDYsNzMuNzU0eiIvPgoJPC9nPgoJPGc+CgkJPHBhdGggc3R5bGU9ImZpbGw6I0ZGMUExQTsiIGQ9Ik0xMjEuNzcsMTA0LjE3MmMwLDQuNTItMy42NjIsOC4xODEtOC4xODMsOC4xODFsMCwwYy00LjUxOSwwLTguMTgxLTMuNjYxLTguMTgxLTguMTgxVjgwLjQzNiAgICBjMC00LjUyLDMuNjYyLTguMTgzLDguMTgxLTguMTgzbDAsMGM0LjUyMSwwLDguMTgzLDMuNjYzLDguMTgzLDguMTgzVjEwNC4xNzJ6Ii8+Cgk8L2c+Cgk8Zz4KCQk8cGF0aCBzdHlsZT0iZmlsbDojRkY3Njc2OyIgZD0iTTExMy41ODcsNzIuMjU0Yy00LjUxOSwwLTguMTgxLDMuNjYzLTguMTgxLDguMTgzdjEuNjFjMCw0LjUxOSwzLjY2Miw4LjE4MSw4LjE4MSw4LjE4MSAgICBjNC41MjEsMCw4LjE4My0zLjY2Miw4LjE4My04LjE4MXYtMS42MUMxMjEuNzcsNzUuOTE3LDExOC4xMDgsNzIuMjU0LDExMy41ODcsNzIuMjU0eiIvPgoJPC9nPgoJPGc+CgkJPHBhdGggc3R5bGU9ImZpbGw6IzMzMzYzQTsiIGQ9Ik0xMTMuNTg3LDExMy44NTNjLTUuMzM4LDAtOS42ODEtNC4zNDMtOS42ODEtOS42ODFWODAuNDM3YzAtNS4zMzksNC4zNDMtOS42ODMsOS42ODEtOS42ODMgICAgYzUuMzM5LDAsOS42ODMsNC4zNDQsOS42ODMsOS42ODN2MjMuNzM1QzEyMy4yNywxMDkuNTEsMTE4LjkyNiwxMTMuODUzLDExMy41ODcsMTEzLjg1M3ogTTExMy41ODcsNzMuNzU0ICAgIGMtMy42ODQsMC02LjY4MSwyLjk5OC02LjY4MSw2LjY4M3YyMy43MzVjMCwzLjY4NCwyLjk5Nyw2LjY4MSw2LjY4MSw2LjY4MWMzLjY4NSwwLDYuNjgzLTIuOTk3LDYuNjgzLTYuNjgxVjgwLjQzNyAgICBDMTIwLjI3LDc2Ljc1MiwxMTcuMjcyLDczLjc1NCwxMTMuNTg3LDczLjc1NHoiLz4KCTwvZz4KCTxnPgoJCTxwYXRoIHN0eWxlPSJmaWxsOiM4REU0RkY7IiBkPSJNNjYuOTIyLDExLjM5SDYwLjAxYy0yNC43NzEsMC00NC45MjYsMjAuMTU2LTQ0LjkyNiw0NC45Mjh2NTEuODM4ICAgIGMwLDkuNTQzLDcuNzM0LDE3LjI3OSwxNy4yNzksMTcuMjc5aDYyLjIwNWM5LjU0NSwwLDE3LjI4MS03LjczNiwxNy4yODEtMTcuMjc5VjU2LjMxN0MxMTEuODUsMzEuNTQ2LDkxLjY5NSwxMS4zOSw2Ni45MjIsMTEuMzl6ICAgICIvPgoJPC9nPgoJPGc+CgkJPHBhdGggc3R5bGU9ImZpbGw6IzAwQUFGRjsiIGQ9Ik02Ni45MjIsMjMuNTkzSDYwLjAxYy0yNC43NzEsMC00NC45MjYsMjAuMTU2LTQ0LjkyNiw0NC45Mjh2MzkuNjM1ICAgIGMwLDkuNTQzLDcuNzM0LDE3LjI3OSwxNy4yNzksMTcuMjc5aDYyLjIwNWM5LjU0NSwwLDE3LjI4MS03LjczNiwxNy4yODEtMTcuMjc5VjY4LjUyQzExMS44NSw0My43NDksOTEuNjk1LDIzLjU5Myw2Ni45MjIsMjMuNTkzICAgIHoiLz4KCTwvZz4KCTxnPgoJCTxwYXRoIHN0eWxlPSJmaWxsOiNGRjFBMUE7IiBkPSJNOTUuNjMxLDk2LjU0MWMwLDguMDkxLTYuNTU5LDE0LjY1Mi0xNC42NSwxNC42NTJINDUuOTU0Yy04LjA5LDAtMTQuNjUtNi41NjItMTQuNjUtMTQuNjUyVjg1LjU1MiAgICBjMC04LjA5LDYuNTYxLTE0LjY0OCwxNC42NS0xNC42NDhoMzUuMDI3YzguMDkyLDAsMTQuNjUsNi41NTksMTQuNjUsMTQuNjQ4Vjk2LjU0MXoiLz4KCTwvZz4KCTxnPgoJCTxwYXRoIHN0eWxlPSJmaWxsOiNGRjc2NzY7IiBkPSJNNDUuOTU0LDcwLjkwM2MtNS4zNjksMC0xMC4wNTEsMi44OTYtMTIuNjAzLDcuMjA1YzIuNTUyLDQuMzEsNy4yMzMsNy4yMDksMTIuNjAzLDcuMjA5aDM1LjAyNyAgICBjNS4zNjksMCwxMC4wNTEtMi44OTksMTIuNjAxLTcuMjA5Yy0yLjU1MS00LjMwOS03LjIzMi03LjIwNS0xMi42MDEtNy4yMDVINDUuOTU0eiIvPgoJPC9nPgoJPGc+CgkJPHBhdGggc3R5bGU9ImZpbGw6IzMzMzYzQTsiIGQ9Ik05NS41NzEsNTguODFjLTAuODI4LDAtMS41LTAuNjcxLTEuNS0xLjVjMC0xNS42MS0xMi43LTI4LjMxLTI4LjMxMi0yOC4zMWgtNC41ODUgICAgYy0xNS42MSwwLTI4LjMxMSwxMi43LTI4LjMxMSwyOC4zMWMwLDAuODI5LTAuNjcyLDEuNS0xLjUsMS41cy0xLjUtMC42NzEtMS41LTEuNUMyOS44NjQsNDAuMDQ1LDQzLjkxLDI2LDYxLjE3NCwyNmg0LjU4NSAgICBjMTcuMjY2LDAsMzEuMzEyLDE0LjA0NSwzMS4zMTIsMzEuMzFDOTcuMDcxLDU4LjEzOCw5Ni4zOTksNTguODEsOTUuNTcxLDU4LjgxeiIvPgoJPC9nPgoJPGc+CgkJPHBhdGggc3R5bGU9ImZpbGw6IzMzMzYzQTsiIGQ9Ik05NS44NSw2OC40NzljLTEuMjg3LDAtMi4zMzQtMS4wNDgtMi4zMzQtMi4zMzZ2LTIuNjMzYzAtMS4yODcsMS4wNDctMi4zMzQsMi4zMzQtMi4zMzQgICAgczIuMzM0LDEuMDQ3LDIuMzM0LDIuMzM0djIuNjMzQzk4LjE4NCw2Ny40MzIsOTcuMTM3LDY4LjQ3OSw5NS44NSw2OC40Nzl6Ii8+Cgk8L2c+Cgk8cGF0aCBzdHlsZT0iZmlsbDojMzMzNjNBOyIgZD0iTTc4LjQ5NSwxMS4zNUM3Ni42MjMsNC44MDgsNzAuNjAyLDAsNjMuNDY3LDBDNTYuMzMzLDAsNTAuMzExLDQuODA3LDQ4LjQ0LDExLjM1ICAgQzI4LjQyLDE2LjUwNCwxMy41ODQsMzQuNzEsMTMuNTg0LDU2LjMxN3Y1MS44MzhjMCwxMC4zNTUsOC40MjUsMTguNzc5LDE4Ljc3OSwxOC43NzloNjIuMjA1YzEwLjM1NiwwLDE4Ljc4MS04LjQyNCwxOC43ODEtMTguNzc5ICAgVjU2LjMxN0MxMTMuMzUsMzQuNzExLDk4LjUxNSwxNi41MDUsNzguNDk1LDExLjM1eiBNNjMuNDY3LDNjNS4xODUsMCw5LjY0NywzLjE0MSwxMS41OTQsNy42MTkgICBjLTIuNjQ1LTAuNDctNS4zNjEtMC43MjktOC4xMzktMC43MjlINjAuMDFjLTIuNzc3LDAtNS40OTMsMC4yNTktOC4xMzcsMC43MjlDNTMuODIxLDYuMTQxLDU4LjI4MiwzLDYzLjQ2NywzeiBNMTEwLjM1LDEwOC4xNTUgICBjMCw4LjcwMS03LjA3OSwxNS43NzktMTUuNzgxLDE1Ljc3OUgzMi4zNjRjLTguNzAxLDAtMTUuNzc5LTcuMDc5LTE1Ljc3OS0xNS43NzlWNTYuMzE3YzAtMTkuNzM1LDEzLjIzNi0zNi40MjYsMzEuMjk0LTQxLjY5ICAgYy0wLjAyMiwwLjMzNy0wLjA1MSwwLjY3Mi0wLjA1MSwxLjAxNWMwLDAuODI5LDAuNjcyLDEuNSwxLjUsMS41czEuNS0wLjY3MSwxLjUtMS41YzAtMC42MTIsMC4wNTktMS4yMSwwLjE0My0xLjc5OSAgIGMyLjkxOC0wLjYyLDUuOTQxLTAuOTUzLDkuMDQxLTAuOTUzaDYuOTEyYzMuMTAxLDAsNi4xMjQsMC4zMzMsOS4wNDIsMC45NTRjMC4wODQsMC41ODksMC4xNDMsMS4xODYsMC4xNDMsMS43OTggICBjMCwwLjgyOSwwLjY3MiwxLjUsMS41LDEuNXMxLjUtMC42NzEsMS41LTEuNWMwLTAuMzQyLTAuMDMtMC42NzctMC4wNTEtMS4wMTRjMTguMDU3LDUuMjY1LDMxLjI5NCwyMS45NTUsMzEuMjk0LDQxLjY5VjEwOC4xNTV6Ii8+Cgk8Zz4KCQk8cGF0aCBzdHlsZT0iZmlsbDojMzMzNjNBOyIgZD0iTTgwLjk4MSw2OS40MDNINDUuOTU0Yy04LjkwNSwwLTE2LjE1LDcuMjQ0LTE2LjE1LDE2LjE0OHYxMC45ODkgICAgYzAsOC45MDYsNy4yNDUsMTYuMTUyLDE2LjE1LDE2LjE1MmgzNS4wMjdjOC45MDUsMCwxNi4xNS03LjI0NiwxNi4xNS0xNi4xNTJWODUuNTUyQzk3LjEzMSw3Ni42NDcsODkuODg2LDY5LjQwMyw4MC45ODEsNjkuNDAzeiAgICAgTTgwLjk4MSwxMDkuNjkzSDQ1Ljk1NGMtNC44MDUsMC05LjAwNC0yLjU5OS0xMS4yOTktNi40NTdoMS45OGMwLjgyOCwwLDEuNS0wLjY3MSwxLjUtMS41cy0wLjY3Mi0xLjUtMS41LTEuNWgtMy4yOTQgICAgYy0wLjM0NC0xLjE3NC0wLjUzOC0yLjQxMi0wLjUzOC0zLjY5NVY4NS41NTJjMC03LjI1LDUuODk5LTEzLjE0OCwxMy4xNS0xMy4xNDhoMzUuMDI3YzcuMjUxLDAsMTMuMTUsNS44OTgsMTMuMTUsMTMuMTQ4djEwLjk4OSAgICBjMCwxLjI4NC0wLjE5MywyLjUyMi0wLjUzOCwzLjY5NWgtMy4yOTRjLTAuODI4LDAtMS41LDAuNjcxLTEuNSwxLjVzMC42NzIsMS41LDEuNSwxLjVoMS45OCAgICBDODkuOTg1LDEwNy4wOTUsODUuNzg2LDEwOS42OTMsODAuOTgxLDEwOS42OTN6Ii8+CgkJPHBhdGggc3R5bGU9ImZpbGw6IzMzMzYzQTsiIGQ9Ik01MS45NjcsMTAwLjIzNmgtNy42NjZjLTAuODI4LDAtMS41LDAuNjcxLTEuNSwxLjVzMC42NzIsMS41LDEuNSwxLjVoNy42NjYgICAgYzAuODI4LDAsMS41LTAuNjcxLDEuNS0xLjVTNTIuNzk1LDEwMC4yMzYsNTEuOTY3LDEwMC4yMzZ6Ii8+CgkJPHBhdGggc3R5bGU9ImZpbGw6IzMzMzYzQTsiIGQ9Ik02Ny4zLDEwMC4yMzZoLTcuNjY2Yy0wLjgyOCwwLTEuNSwwLjY3MS0xLjUsMS41czAuNjcyLDEuNSwxLjUsMS41SDY3LjMgICAgYzAuODI4LDAsMS41LTAuNjcxLDEuNS0xLjVTNjguMTI4LDEwMC4yMzYsNjcuMywxMDAuMjM2eiIvPgoJCTxwYXRoIHN0eWxlPSJmaWxsOiMzMzM2M0E7IiBkPSJNODIuNjMyLDEwMC4yMzZoLTcuNjY2Yy0wLjgyOCwwLTEuNSwwLjY3MS0xLjUsMS41czAuNjcyLDEuNSwxLjUsMS41aDcuNjY2ICAgIGMwLjgyOCwwLDEuNS0wLjY3MSwxLjUtMS41UzgzLjQ2LDEwMC4yMzYsODIuNjMyLDEwMC4yMzZ6Ii8+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg==',
};

// eslint-disable-next-line max-len
app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerDocument, options));
app.use('/uploads', express.static('uploads'));
app.use('/places', placesRoute);
app.use('/blogs', blogsRoute);
app.use('/contacts', contactRoute);
app.use('/users', usersRoute);


// connect to database
// DB_CONNECTION_2_2_12: use clusters connection version 2.2.12 or later
// DB_CONNECTION_3_0: use clusters connection version 3.0 or later
mongoose.connect(
    process.env.DB_CONNECTION_2_2_12,
    {
      useNewUrlParser: true,
      useUnifiedTopology: true,
    },
).then(() => console.log('MongoDB Connected!'))
    .catch((err) => {
      console.log(err);
    });

// Routes
app.get('/', function(req, res) {
  res.send('We are at server');
});

module.exports = app;
